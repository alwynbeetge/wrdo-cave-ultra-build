(()=>{var e={};e.id=9394,e.ids=[9394],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},86624:e=>{"use strict";e.exports=require("querystring")},76162:e=>{"use strict";e.exports=require("stream")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},39697:()=>{},62302:()=>{},30107:()=>{},47524:()=>{},5763:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var i={};s.r(i),s.d(i,{GET:()=>d,POST:()=>l,dynamic:()=>u});var o=s(49303),n=s(88716),r=s(60670),a=s(87070),c=s(79097);let u="force-dynamic";async function d(e){try{return a.NextResponse.json({message:"WebSocket server initialized",endpoint:"/api/socketio",status:"ready"})}catch(e){return console.error("WebSocket initialization error:",e),a.NextResponse.json({error:"Failed to initialize WebSocket server"},{status:500})}}async function l(e){try{let{type:t,userId:s,data:i}=await e.json();switch(t){case"send_notification":if(i.notification&&s)return c.p.sendNotificationToUser(s,i.notification),a.NextResponse.json({success:!0});break;case"send_global_notification":if(i.notification)return c.p.sendGlobalNotification(i.notification),a.NextResponse.json({success:!0});break;case"agent_completion":if(s&&i.agentId&&i.result)return c.p.sendAgentCompletion(s,i.agentId,i.result),a.NextResponse.json({success:!0});break;case"task_update":if(s&&i.taskId&&i.status)return c.p.sendTaskUpdate(s,i.taskId,i.status,i.progress),a.NextResponse.json({success:!0});break;default:return a.NextResponse.json({error:"Unknown notification type"},{status:400})}return a.NextResponse.json({error:"Missing required parameters"},{status:400})}catch(e){return console.error("WebSocket API error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/socketio/route",pathname:"/api/socketio",filename:"route",bundlePath:"app/api/socketio/route"},resolvedPagePath:"/home/ubuntu/wrdo-cave-ultra-build/app/api/socketio/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=p,f="/api/socketio/route";function y(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},79097:(e,t,s)=>{"use strict";s.d(t,{p:()=>o}),s(90117);class i{constructor(){this.io=null,this.activeConnections=new Map}static getInstance(){return i.instance||(i.instance=new i),i.instance}initializeIO(e){this.io=e,this.setupEventHandlers(),console.log("\uD83D\uDD0C WRDO WebSocket server initialized")}setupEventHandlers(){this.io&&this.io.on("connection",e=>{console.log(`ðŸ”— Client connected: ${e.id}`),e.on("authenticate",t=>{try{this.addUserConnection(t.userId,e.id),e.join(`user:${t.userId}`),e.join("global"),e.emit("authenticated",{success:!0,userId:t.userId,timestamp:new Date}),console.log(`âœ… User ${t.userId} authenticated on socket ${e.id}`)}catch(t){e.emit("auth_error",{error:"Authentication failed"})}}),e.on("notification_read",e=>{this.markNotificationRead(e.notificationId,e.userId)}),e.on("agent_status_request",t=>{this.sendAgentStatus(t.agentId,t.userId,e)}),e.on("system_health_request",t=>{this.sendSystemHealth(t,e)}),e.on("disconnect",()=>{this.removeUserConnection(e.id),console.log(`ðŸ”Œ Client disconnected: ${e.id}`)})})}sendNotificationToUser(e,t){return!!this.io&&(this.io.to(`user:${e}`).emit("notification",t),console.log(`ðŸ“¬ Notification sent to user ${e}:`,t.title),!0)}sendGlobalNotification(e){return!!this.io&&(this.io.to("global").emit("global_notification",e),console.log(`ðŸ“¢ Global notification sent:`,e.title),!0)}sendSystemEvent(e,t){return!!this.io&&(this.io.to(`user:${e}`).emit("system_event",t),console.log(`âš¡ System event sent to user ${e}:`,t.type),!0)}sendAgentCompletion(e,t,s){let i={id:`agent_${t}_${Date.now()}`,type:"agent_complete",title:"Agent Task Completed",message:`Your ${t} agent has completed its task successfully.`,severity:"medium",userId:e,metadata:{agentId:t,result:s},timestamp:new Date,read:!1};this.sendNotificationToUser(e,i)}sendTaskUpdate(e,t,s,i){let o={id:`task_${t}_${Date.now()}`,type:"task_update",title:"Task Status Update",message:`Task ${t} status: ${s}${i?` (${i}%)`:""}`,severity:"low",userId:e,metadata:{taskId:t,status:s,progress:i},timestamp:new Date,read:!1};this.sendNotificationToUser(e,o)}sendEmailAlert(e,t){let s={id:`email_${Date.now()}`,type:"email_alert",title:"Important Email Received",message:`High-priority email from ${t.sender}: ${t.subject}`,severity:"urgent"===t.priority?"critical":"medium",userId:e,metadata:t,timestamp:new Date,read:!1};this.sendNotificationToUser(e,s)}sendSecurityAlert(e,t,s){let i={id:`security_${Date.now()}`,type:"security_event",title:"Security Alert",message:`Security event detected: ${t}`,severity:"high",userId:e,metadata:{eventType:t,details:s},timestamp:new Date,read:!1};this.sendNotificationToUser(e,i)}sendSystemHealth(e,t){let s={timestamp:new Date,status:"healthy",uptime:process.uptime(),memory:process.memoryUsage(),activeConnections:this.activeConnections.size,services:{ai:"operational",database:"operational",email:"operational",websocket:"operational"}};t.emit("system_health",s)}sendAgentStatus(e,t,s){let i={agentId:e,status:"active",lastExecution:new Date,tasksCompleted:Math.floor(100*Math.random()),averageExecutionTime:Math.floor(5e3*Math.random())+1e3,successRate:.95+.05*Math.random()};s.emit("agent_status",i)}addUserConnection(e,t){this.activeConnections.has(e)||this.activeConnections.set(e,[]),this.activeConnections.get(e)?.push(t)}removeUserConnection(e){Array.from(this.activeConnections.entries()).forEach(([t,s])=>{let i=s.indexOf(e);i>-1&&(s.splice(i,1),0===s.length&&this.activeConnections.delete(t))})}async markNotificationRead(e,t){console.log(`âœ… Notification ${e} marked as read by user ${t}`)}getActiveConnectionsCount(){return this.activeConnections.size}isUserConnected(e){return this.activeConnections.has(e)}}let o=i.getInstance()}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[9276,5972,117],()=>s(5763));module.exports=i})();